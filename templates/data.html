{% extends "base.html" %}

{% block content %}
<div class="space-y-8 animate-fade-in">
    <div class="flex flex-col md:flex-row justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">ðŸ“Š Eksplorasi Data</h1>
            <p class="mt-2 text-gray-600 dark:text-gray-400">Analisis data historis cuaca Citeko</p>
        </div>
        <div class="mt-4 md:mt-0">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                <i class="fa-solid fa-check-circle mr-2"></i> Data Terupdate
            </span>
        </div>
    </div>

    {% if error %}
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-md shadow-sm" role="alert">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fa-solid fa-circle-exclamation text-red-400"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-red-700 font-bold">Error Loading Data</p>
                <p class="text-sm text-red-600 mt-1">{{ error }}</p>
            </div>
        </div>
    </div>
    {% else %}

    <!-- Summary Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 reveal">
        <!-- Total Records -->
        <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-100 dark:bg-slate-900 dark:border-gray-700">
            <div class="flex items-center">
                <div class="p-3 rounded-lg bg-blue-50 text-blue-600">
                    <i class="fa-solid fa-database text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Records</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ summary.total_records }}</p>
                </div>
            </div>
        </div>

        <!-- Start Year -->
        <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-100 dark:bg-slate-900 dark:border-gray-700">
            <div class="flex items-center">
                <div class="p-3 rounded-lg bg-green-50 text-green-600">
                    <i class="fa-regular fa-calendar-check text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Tahun Awal</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ summary.start_year }}</p>
                </div>
            </div>
        </div>

        <!-- End Year -->
        <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-100 dark:bg-slate-900 dark:border-gray-700">
            <div class="flex items-center">
                <div class="p-3 rounded-lg bg-purple-50 text-purple-600">
                    <i class="fa-regular fa-calendar-xmark text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Tahun Akhir</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ summary.end_year }}</p>
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-100 dark:bg-slate-900 dark:border-gray-700">
            <div class="flex items-center">
                <div class="p-3 rounded-lg bg-yellow-50 text-yellow-600">
                    <i class="fa-solid fa-list-check text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Fitur</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ summary.total_features }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 dark:bg-slate-900 dark:border-gray-700 reveal">
        <div class="px-6 py-5 border-b border-gray-100 bg-gray-50/50 dark:bg-slate-800 dark:border-gray-700">
            <h2 class="text-lg font-bold text-gray-900 flex items-center">
                <i class="fa-solid fa-chart-area mr-2 text-accent dark:text-accent"></i> <span class="dark:text-white">Visualisasi Time Series</span>
            </h2>
        </div>
        <div class="p-6 space-y-10">
            <!-- Temperature Chart -->
            <div class="relative">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Suhu Rata-rata (TAVG)</h3>
                <div class="h-64 w-full">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>
            
            <!-- Humidity Chart -->
            <div class="relative">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Kelembapan Rata-rata (RH_AVG)</h3>
                <div class="h-64 w-full">
                    <canvas id="humidityChart"></canvas>
                </div>
            </div>

            <!-- Rainfall Chart -->
            <div class="relative">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Curah Hujan (RR)</h3>
                <div class="h-64 w-full">
                    <canvas id="rainChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 dark:bg-slate-900 dark:border-gray-700 reveal">
        <div class="px-6 py-5 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center dark:bg-slate-800 dark:border-gray-700">
            <h2 class="text-lg font-bold text-gray-900 flex items-center dark:text-white">
                <i class="fa-solid fa-table mr-2 text-accent dark:text-accent"></i> Dataset (100 Data Pertama)
            </h2>
            <button class="text-sm text-accent hover:text-sky-700 font-medium transition-colors">
                Download CSV <i class="fa-solid fa-download ml-1"></i>
            </button>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 dark:bg-slate-800">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">TAVG (Â°C)</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">RH_AVG (%)</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">RR (mm)</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200 dark:bg-slate-900 dark:divide-gray-700">
                    {% for row in table_data %}
                    <tr class="hover:bg-gray-50 transition-colors dark:hover:bg-slate-800">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">{{ row.date }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                            <span class="px-2 py-1 rounded-full bg-red-50 text-red-700 text-xs font-medium">{{ row.TAVG }}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <span class="px-2 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-medium">{{ row.RH_AVG }}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <span class="px-2 py-1 rounded-full bg-green-50 text-green-700 text-xs font-medium">{{ row.RR }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="bg-gray-50 px-6 py-3 border-t border-gray-200 dark:bg-slate-800 dark:border-gray-700">
            <p class="text-xs text-gray-500 text-center dark:text-gray-400">Menampilkan 100 data terbaru dari total {{ summary.total_records }} records.</p>
        </div>
    </div>

    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    const chartData = {{ chart_data | tojson }};

    // Helper to create charts with modern config
    function createLineChart(ctx, label, data, color, yLabel) {
        // Create gradient
        const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, color + '40'); // 25% opacity
        gradient.addColorStop(1, color + '00'); // 0% opacity

        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartData.date,
                datasets: [{
                    label: label,
                    data: data,
                    borderColor: color,
                    backgroundColor: gradient,
                    borderWidth: 2,
                    pointRadius: 0,
                    pointHoverRadius: 4,
                    fill: true,
                    tension: 0.4 // Smooth curves
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1f2937',
                        bodyColor: '#4b5563',
                        borderColor: '#e5e7eb',
                        borderWidth: 1,
                        padding: 10,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return context.parsed.y + ' ' + (yLabel.includes('Temperatur') ? 'Â°C' : yLabel.includes('Kelembapan') ? '%' : 'mm');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        grid: {
                            borderDash: [2, 4],
                            color: '#f3f4f6'
                        },
                        ticks: {
                            font: {
                                family: "'Inter', sans-serif",
                                size: 11
                            },
                            color: '#9ca3af'
                        },
                        title: {
                            display: true,
                            text: yLabel,
                            color: '#6b7280',
                            font: {
                                size: 12,
                                weight: 500
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            maxTicksLimit: 8,
                            font: {
                                family: "'Inter', sans-serif",
                                size: 11
                            },
                            color: '#9ca3af'
                        }
                    }
                }
            }
        });
    }

    // Initialize charts with brand colors
    createLineChart(document.getElementById('tempChart'), 'Suhu Rata-rata', chartData.tavg, '#ef4444', 'Temperatur (Â°C)');
    createLineChart(document.getElementById('humidityChart'), 'Kelembapan Rata-rata', chartData.rh_avg, '#3b82f6', 'Kelembapan (%)');
    createLineChart(document.getElementById('rainChart'), 'Curah Hujan', chartData.rr, '#10b981', 'Curah Hujan (mm)');

</script>
{% endblock %}
