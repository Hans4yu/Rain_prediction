{% extends "base.html" %}

{% block content %}
<div class="space-y-8">
    <h1 class="text-3xl font-bold text-gray-900">üìà Evaluasi Model</h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- LSTM Metrics -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="bg-blue-600 px-6 py-4">
                <h2 class="text-xl font-bold text-white">üß† Model LSTM</h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm text-gray-500 font-medium">MAE</p>
                        <p class="text-2xl font-bold text-blue-700" id="lstm-mae">-</p>
                        <p class="text-xs text-gray-400">mm</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm text-gray-500 font-medium">MSE</p>
                        <p class="text-2xl font-bold text-blue-700" id="lstm-mse">-</p>
                        <p class="text-xs text-gray-400">mm¬≤</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm text-gray-500 font-medium">RMSE</p>
                        <p class="text-2xl font-bold text-blue-700" id="lstm-rmse">-</p>
                        <p class="text-xs text-gray-400">mm</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prophet Metrics -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="bg-purple-600 px-6 py-4">
                <h2 class="text-xl font-bold text-white">üìà Model Prophet</h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="p-4 bg-purple-50 rounded-lg">
                        <p class="text-sm text-gray-500 font-medium">MAE</p>
                        <p class="text-2xl font-bold text-purple-700" id="prophet-mae">-</p>
                        <p class="text-xs text-gray-400">mm</p>
                    </div>
                    <div class="p-4 bg-purple-50 rounded-lg">
                        <p class="text-sm text-gray-500 font-medium">MSE</p>
                        <p class="text-2xl font-bold text-purple-700" id="prophet-mse">-</p>
                        <p class="text-xs text-gray-400">mm¬≤</p>
                    </div>
                    <div class="p-4 bg-purple-50 rounded-lg">
                        <p class="text-sm text-gray-500 font-medium">RMSE</p>
                        <p class="text-2xl font-bold text-purple-700" id="prophet-rmse">-</p>
                        <p class="text-xs text-gray-400">mm</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Chart -->
    <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-semibold mb-6">‚öñÔ∏è Perbandingan Model</h2>
        <div class="h-80">
            <canvas id="comparisonChart"></canvas>
        </div>
        <div id="conclusion" class="mt-6 p-4 bg-green-50 border-l-4 border-green-500 rounded text-green-800 hidden">
            <!-- Conclusion text will be injected here -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/api/evaluation-metrics')
            .then(response => response.json())
            .then(data => {
                // Update LSTM UI
                document.getElementById('lstm-mae').textContent = data.lstm.mae.toFixed(2);
                document.getElementById('lstm-mse').textContent = data.lstm.mse.toFixed(2);
                document.getElementById('lstm-rmse').textContent = data.lstm.rmse.toFixed(2);

                // Update Prophet UI
                document.getElementById('prophet-mae').textContent = data.prophet.mae.toFixed(2);
                document.getElementById('prophet-mse').textContent = data.prophet.mse.toFixed(2);
                document.getElementById('prophet-rmse').textContent = data.prophet.rmse.toFixed(2);

                // Create Comparison Chart
                const ctx = document.getElementById('comparisonChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['MAE', 'RMSE'],
                        datasets: [
                            {
                                label: 'LSTM',
                                data: [data.lstm.mae, data.lstm.rmse],
                                backgroundColor: '#2563eb',
                                borderColor: '#1d4ed8',
                                borderWidth: 1
                            },
                            {
                                label: 'Prophet',
                                data: [data.prophet.mae, data.prophet.rmse],
                                backgroundColor: '#9333ea',
                                borderColor: '#7e22ce',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Error (mm)'
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Perbandingan Error Model (Lebih Rendah Lebih Baik)'
                            }
                        }
                    }
                });

                // Conclusion
                const bestModel = data.lstm.mae < data.prophet.mae ? 'LSTM' : 'Prophet';
                const diff = Math.abs(data.lstm.mae - data.prophet.mae).toFixed(2);
                const conclusionDiv = document.getElementById('conclusion');
                conclusionDiv.innerHTML = `‚úÖ <strong>Kesimpulan:</strong> Model <strong>${bestModel}</strong> menunjukkan performa yang lebih baik dengan MAE lebih rendah (selisih ${diff} mm).`;
                conclusionDiv.classList.remove('hidden');
            })
            .catch(error => console.error('Error fetching metrics:', error));
    });
</script>
{% endblock %}